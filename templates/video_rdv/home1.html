<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>{{ app_name }}</title>
  <style>
    :root { --bg:#0b0b0b; --fg:#f7f7f7; --card:#141414; --muted:#9aa0a6; --accent:#ffd300; }
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--fg);font-family:Inter,system-ui,Arial}
    .wrap{max-width:920px;margin:0 auto;padding:32px}
    .card{background:var(--card);border-radius:16px;padding:24px;box-shadow:0 10px 30px rgba(0,0,0,.35);}
    h1{font-size:28px;margin:0 0 8px}
    p{color:var(--muted)}
    form{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
    input,select,button{font-size:16px;border-radius:10px;border:1px solid #222;background:#0f0f0f;color:#fff;padding:10px 12px}
    button{background:var(--accent);color:#111;border:none;cursor:pointer}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:16px}
    @media (max-width:760px){ .grid{grid-template-columns:1fr} }
    .demo{margin-top:12px;display:flex;gap:10px;flex-wrap:wrap}
    a.btn{background:#1f1f1f;color:#fff;text-decoration:none;padding:8px 12px;border-radius:10px;border:1px solid #333}
    .note{font-size:14px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>üé• {{ app_name }}</h1>
      <p>Cr√©er une salle Jitsi gratuite (meet.jit.si) et la rejoindre depuis votre application.</p>

      <div class="grid">
        <div>
          <h3>Cr√©er une nouvelle salle</h3>
          <form id="frm">
            <input type="text" id="prefix" placeholder="Pr√©fixe (ex: coaching)" value="coaching"/>
            <input type="text" id="subject" placeholder="Sujet" value="S√©ance de coaching"/>
            <select id="role">
              <option value="coach">Coach</option>
              <option value="client" selected>Client</option>
            </select>
            <button type="submit">Cr√©er & Rejoindre</button>
          </form>
          <div class="note">Astuce : vous pouvez d√©finir un mot de passe via la variable <code>JITSI_ROOM_PASSWORD</code>.</div>
        </div>
        <div>
          <h3>Rejoindre une salle existante</h3>
          <form action="" onsubmit="event.preventDefault(); joinExisting();">
            <input type="text" id="slug" placeholder="Identifiant de salle (ex: coaching-abc123)"/>
            <input type="text" id="name" placeholder="Votre nom" value="Invit√©"/>
            <button type="submit">Rejoindre</button>
          </form>
          <div class="demo">
            <a class="btn" href="#" onclick="document.getElementById('slug').value='coaching-demo';return false;">Exemple : coaching-demo</a>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
const frm = document.getElementById('frm');
frm.addEventListener('submit', async (e)=>{
  e.preventDefault();
  const payload = {
    prefix: document.getElementById('prefix').value || "coaching",
    subject: document.getElementById('subject').value || "S√©ance de coaching",
    role: document.getElementById('role').value || "client",
    redirect: true
  };
  const res = await fetch('/seance/nouveau', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)});
  const data = await res.json();
  if (data.join_url){
    const name = encodeURIComponent(document.getElementById('name')?.value || "Coach");
    window.location.href = data.join_url + "?name=" + name + "&role=" + encodeURIComponent(payload.role);
  }
});

function joinExisting(){
  const slug = document.getElementById('slug').value.trim();
  const name = encodeURIComponent(document.getElementById('name').value.trim() || "Invit√©");
  if(!slug){ alert("Veuillez saisir un identifiant de salle"); return; }
  window.location.href = "/seance/" + encodeURIComponent(slug) + "?name=" + name;
}
</script>
</body>
</html>
